{"version":3,"file":null,"sources":["../src/config/index.js","../src/middlewares/accessLogger.js","../src/middlewares/reqParser.js","../src/middlewares/catchError.js","../src/middlewares/reqLog.js","../src/middlewares/extendReqRes.js","../src/middlewares/index.js","../src/models/User/User.js","../src/models/index.js","../src/controllers/Auth/Auth.js","../src/controllers/Domain/Domain.js","../src/controllers/Channel/Channel.js","../src/controllers/index.js","../src/utils/Nodemailer/index.js","../src/utils/index.js","../src/api/auth/auth.js","../src/api/domain/domain.js","../src/api/api.js","../src/App.js","../src/index.js"],"sourcesContent":["global.__DEV__ = true;\n// __STAGE__\nglobal.__PROD__ = false;\n\nexport default {\n  name: 'Your super app',\n  port: 3001,\n  db: {\n    url: 'mongodb://localhost/test',\n  },\n  jwt: {\n    secret: 'YOUR_SECRET',\n  },\n  nodemailer: {\n    service: 'mail',\n    host: 'smtp.mail.ru',\n    auth: {\n      user: 'molodoyrustik@mail.ru',\n      pass: 'molodoy'\n    }\n  },\n};\n","import leftPad from 'left-pad';\n\nfunction levelFn(data) {\n  if (data.err || data.status >= 500 || data.duration > 10000) { // server internal error or error\n    return 'error';\n  } else if (data.status >= 400 || data.duration > 3000) { // client error\n    return 'warn';\n  }\n  return 'info';\n}\n\nfunction logStart(data) {\n  return `${leftPad(data.method, 4)} ${data.url} started reqId=${data.reqId}`;\n}\n\nfunction logFinish(data) {\n  const time = (data.duration || 0).toFixed(3);\n  const length = data.length || 0;\n  return `${leftPad(data.method, 4)} ${data.url} ${leftPad(data.status, 3)} ${leftPad(time, 7)}ms ${leftPad(length, 5)}b reqId=${data.reqId}`;\n}\n\nexport default (params) => ([\n  (req, res, next) => {\n    const data = {}\n    if (!req.log) throw 'has no req.log!'\n    const log = req.log.child({\n      component: 'req',\n    });\n\n    data.reqId = req.reqId\n    data.method = req.method\n    if (req.ws) data.method = 'WS'\n    data.host = req.headers.host\n    data.url = (req.baseUrl || '') + (req.url || '-')\n    data.referer = req.header('referer') || req.header('referrer')\n    data.ip = req.ip || req.connection.remoteAddress ||\n        (req.socket && req.socket.remoteAddress) ||\n        (req.socket.socket && req.socket.socket.remoteAddress) ||\n        '127.0.0.1'\n\n\n    if (__DEV__) {\n      log.debug(data, logStart(data));\n      if (req.body) {\n        log.trace(JSON.stringify(req.body));\n      }\n    }\n\n    const hrtime = process.hrtime();\n    function logging() {\n      data.status = res.statusCode\n      data.length = res.getHeader('Content-Length')\n\n      const diff = process.hrtime(hrtime);\n      data.duration = diff[0] * 1e3 + diff[1] * 1e-6\n\n      log[levelFn(data)](data, logFinish(data));\n    }\n    res.on('finish', logging);\n    res.on('close', logging);\n    next();\n  }\n])\n","import cookieParser from 'cookie-parser'\nimport bodyParser from 'body-parser'\nimport cors from 'cors'\n\nexport default (ctx) => ([\n  bodyParser.json(),\n  bodyParser.urlencoded({ extended: true }),\n  cookieParser(),\n  cors(),\n])\n","export default (ctx) => (\n  (err, req, res, next) => {\n    if(req && req.log && req.log.error){\n      req.log.error({\n        err,\n        query: req.query,\n        body: req.body,\n        headers: req.headers\n      }, (err || {}).stack)\n    } else {\n      console.log(err)\n    }\n    res.status(err.status || 500)\n    return res.json([]);\n    if (res.err) return res.err(err)\n    return res.json(err)\n  }\n)\n","import uuid from 'uuid'\n\nexport default (params) => ([\n  (req, res, next) => {\n    if (__PROD__) {\n      req.reqId = uuid.v4()\n    } else {\n      global.reqId = 1 + (global.reqId || 0)\n      req.reqId = global.reqId\n    }\n    if (params.log) {\n      req.log = params.log.child({\n        reqId: req.reqId,\n      });\n    }\n    next()\n  },\n])\n","import _ from 'lodash'\nexport default (ctx) => ([\n  (req, res, next) => {\n    if (ctx.requests) {\n      _.forEach(ctx.requests, (val, key) => {\n        req[key] = val.bind(req)\n      })\n      // if (req.allParams) {\n      //   req.params = req.allParams.bind(req)()\n      // }\n    }\n    if (ctx.responses) {\n      _.forEach(ctx.responses, (val, key) => {\n        res[key] = val.bind(res)\n      })\n    }\n    next()\n  }\n])\n","// fs\nimport accessLogger from './accessLogger'\nimport reqParser from './reqParser'\nimport catchError from './catchError'\nimport reqLog from './reqLog'\nimport extendReqRes from './extendReqRes'\n\nexport default function (ctx) {\n  return {\n    accessLogger: accessLogger(...arguments),\n    reqParser: reqParser(...arguments),\n    catchError: catchError(...arguments),\n    reqLog: reqLog(...arguments),\n    extendReqRes: extendReqRes(...arguments),\n  }\n}\n","import _ from 'lodash'\nimport jwt from 'jsonwebtoken'\nimport bcrypt from 'bcryptjs'\nimport Promise from 'bluebird'\nconst bcryptGenSalt = Promise.promisify(bcrypt.genSalt)\nconst bcryptHash = Promise.promisify(bcrypt.hash)\nconst bcryptCompare = Promise.promisify(bcrypt.compare)\nimport mongoose from 'mongoose'\n\nexport default (ctx) => {\n  if (!ctx.log) throw '!log'\n\n  const schema = new mongoose.Schema({\n    email: {\n      type: String,\n      required: true,\n      trim: true,\n    },\n    id: {\n      type: String,\n      trim: true,\n    },\n    password: {\n      type: String,\n    },\n    forgotEmailToken: {\n      type: String,\n      trim: true,\n    },\n  }, {\n    collection: 'user',\n    timestamps: true,\n  })\n\n  schema.statics.isValidEmail = function (email) {\n    const re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return re.test(email)\n  }\n  schema.statics.generatePassword = function (length = 10) {\n    return Math.random().toString(36).substr(2, length)\n  }\n  schema.methods.toJSON = function () {\n    return _.omit(this.toObject(), ['password'])\n  }\n  schema.methods.getIdentity = function (params) {\n    const object = _.pick(this.toObject(), ['_id', 'email', 'id'])\n    if (!params) return object\n    return Object.assign(object, params)\n  }\n  schema.methods.generateAuthToken = function (params) {\n    return jwt.sign(this.getIdentity(params), ctx.config.jwt.secret)\n  }\n  schema.methods.verifyPassword = async function (password) {\n    return await bcryptCompare(password, this.password)\n  }\n\n  const SALT_WORK_FACTOR = 10\n  schema.pre('save', function (next) {\n    if (!this.isModified('password')) return next();\n    return bcryptGenSalt(SALT_WORK_FACTOR)\n    .then(salt => {\n      bcryptHash(this.password, salt)\n      .then(hash => {\n        this.password = hash\n        next();\n      })\n    })\n    .catch(next)\n  });\n\n  return mongoose.model('User', schema);\n}\n","import User from './User/User';\n\nexport default function () {\n  return {\n    User: User(...arguments),\n  }\n}\n","import jwt from 'express-jwt'\nimport uniqid from 'uniqid';\nimport crypto from 'crypto';\n\nexport function canonize(str) {\n  return str.toLowerCase().trim()\n}\n\nexport default (ctx) => {\n  const User = ctx.models.User;\n\n  const transporter = ctx.utils.Transporter;\n\n  const controller = {}\n\n  controller.validate = async function (req, res) {\n    if(req.user) {\n      const user = await User.findOne({id: req.user.id})\n      if (!user) return res.status(404).json([{validate: false, message: 'Пользователь не найден в базе'}]);\n      return [{\n        validate: true,\n        __pack: 1,\n        jwt: req.user,\n        user: user,\n      }]\n    }\n    return res.status(404).json([{validate: false, message: 'Пользователь не найден в базе'}]);\n  }\n\n  controller.getUserFields = function (req) {\n    return req.body;\n  }\n\n  controller.validationUserFields = function(userFields, res) {\n    let valid = {\n      isValid: false,\n      message: []\n    }\n\n    if(!userFields.captcha) {\n      valid.isValid = true;\n      valid.message = [{signup: false, message: 'Параметр captcha не передан или введен неверно'}]\n    }\n\n    if(!userFields.email || !userFields.password) {\n      valid.isValid = true;\n      valid.message = [{signup: false, message: 'Параметрs email или password не передан'}]\n    }\n\n    return valid;\n  }\n\n  controller.getUserCriteria = function (req, res) {\n    const params = req.body\n    if (params.email) {\n      return {\n        email: params.email,\n      }\n    }\n    return res.status(400).json([{signup: false, message: 'Параметр email не передан'}]);\n  }\n\n  controller.signup = async function (req, res) {\n    try {\n      const userFields = controller.getUserFields(req, res);\n      const valid = controller.validationUserFields(userFields, res);\n      if (valid.isValid) {\n        return res.status(400).json(valid.message);\n      }\n      const criteria = controller.getUserCriteria(req, res);\n\n      const existUser = await User.findOne(criteria)\n      if (existUser) return res.status(400).json([{signup: false, message: 'Такой email зарегистрирован'}]);\n\n      const user = new User({\n        ...userFields,\n        id: uniqid(),\n        forgotEmailToken: '',\n      });\n\n      await user.save()\n\n      const result = [{\n        signup: true,\n        user,\n        token: user.generateAuthToken(),\n      }]\n\n      return res.json(result)\n\n    } catch(err) {\n      console.log(err);\n      return res.status(500).json(err)\n    }\n  }\n\n  controller.login = async function (req, res) {\n    const params = controller.getUserFields(req, res);\n    if (!params.password) return res.status(400).json([{login: false, message: 'Параметр password не передан'}]);\n\n    const criteria = controller.getUserCriteria(req);\n    const user = await User.findOne(criteria);\n\n    if (!user) return res.status(404).json([{login: false, message: 'Такой пользователь не найден'}]);\n    await user.save();\n\n    if (!await user.verifyPassword(params.password)) {\n      return res.status(400).json([{login: false, message: 'Переданный пароль не подходит'}]);\n    }\n\n    return res.json([{\n      __pack: 1,\n      login: true,\n      user,\n      token: user.generateAuthToken(),\n    }])\n  }\n\n  controller.forgot = async function (req, res) {\n    const params = controller.getUserFields(req, res);\n\n    if (!params.email) return res.status(400).json([{ forgot: false, message: 'Параметр email не передан' }]);\n    if (!params.captcha) return res.status(400).json([{ forgot: false, message: 'Параметр captcha не передан' }]);\n\n    const criteria = controller.getUserCriteria(req);\n    const user = await User.findOne(criteria);\n\n    if (!user) return res.status(404).json([{login: false, message: 'Пользователь с таким email не найден в базе'}]);\n\n    const token = await crypto.randomBytes(32);\n\n    user.forgotEmailToken = token.toString('hex');\n    await user.save();\n\n\n    let siteUrl = 'http://localhost:3000/';\n    if (__PROD__) {\n      siteUrl = 'http://app.ashlie.io/';\n    }\n\n    let mailText = `Перейдите по ссылке чтобы изменить пароль ${siteUrl}auth/forgot/${user.forgotEmailToken}`;\n\n    var mailOptions = {\n      from: 'molodoyrustik@mail.ru',\n      to: user.email,\n      subject: 'Восстановления пароля сайта Ashile.io',\n      text: mailText\n    };\n    await transporter.sendMail(mailOptions);\n\n    const result = [{\n      __pack: 1,\n      forgot: true\n    }];\n    return res.json(result);\n  }\n\n  controller.checkForgotToken = async function (req, res) {\n    const { forgotEmailToken } = req.params;\n    console.log(forgotEmailToken);\n    if (!forgotEmailToken) {\n      return res.status(400).json([{checkForgotToken: false, message: 'Токен не был передан'}]);\n    }\n\n    const criteria = { forgotEmailToken };\n    const user = await User.findOne(criteria);\n\n    if (!user) return res.status(404).json([{checkForgotToken: false, message: 'Пользователь с таким токеном не найден'}]);\n\n    return res.json([{\n        __pack: 1,\n        checkForgotToken: true\n    }]);\n  }\n\n  controller.reset = async function (req, res) {\n    const params = controller.getUserFields(req, res);\n    const { password, checkPassword, captcha, forgotEmailToken, } = params;\n\n    if (!password) return res.status(400).json([{reset: false, message: 'Параметр password не передан'}]);\n    if (!checkPassword) return res.status(400).json([{reset: false, message: 'Параметр checkPassword не передан'}]);\n    if (password !== checkPassword) return res.status(400).json([{reset: false, message: 'Пароли не совпадают'}]);\n    if (!captcha) return res.status(400).json([{reset: false, message: 'Параметр captcha не передан'}]);\n    if (!forgotEmailToken) return res.status(400).json([{reset: false, message: 'Параметр forgotEmailToken не передан'}]);\n\n    const criteria = { forgotEmailToken };\n    const user = await User.findOne(criteria);\n    if (!user) return res.status(404).json([{reset: false, message: 'Не корректный токен'}]);\n    user.forgotEmailToken = '';\n    user.password = password;\n\n    await user.save();\n\n    return res.json([{\n      __pack: 1,\n      reset: true\n    }])\n  }\n\n  controller.getToken = function (req) {\n    if (req.headers.authorization && req.headers.authorization.split( ' ' )[ 0 ] === 'Bearer') {\n      return req.headers.authorization.split( ' ' )[ 1 ]\n    } else if (req.headers['x-access-token']) {\n      return req.headers['x-access-token'];\n    } else if ( req.query && req.query.token ) {\n      return req.query.token\n    } else if ( req.cookies && req.cookies.token  ) {\n      return req.cookies.token\n    }\n    if (__DEV__ && ctx.config && ctx.config.jwt && ctx.config.jwt.devToken) return ctx.config.jwt.devToken\n    return null;\n  }\n\n  controller.parseToken = function (req, res, next) {\n    const token = controller.getToken(req)\n    req.token = token\n    next()\n  }\n\n  controller.parseUser = function (req, res, next) {\n    const options = {\n      secret: ctx.config && ctx.config.jwt.secret || 'SECRET',\n      getToken: req => req.token,\n    }\n    jwt(options)(req, res, (err) => {\n      if (err) req._errJwt = err\n      next()\n    })\n  }\n\n  controller.isAuth = function (req, res, next) {\n    if (req._errJwt) return next(req._errJwt)\n    if (!req.user || !req.user._id) return res.status(401).send('!req.user')\n    next()\n  }\n\n  return controller\n}\n","import jwt from 'express-jwt'\nimport uniqid from 'uniqid';\n\n\nexport default (ctx) => {\n  const User = ctx.models.User;\n  const Domain = ctx.models.Domain;\n\n  let controller = {};\n\n  controller.domains = async function(req, res) {\n    const userID = req.user.id;\n    const user = await User.findOne({id: userID});\n\n    return res.json(user.domains);\n  }\n\n  controller.create = async function(req, res) {\n    const params = req.body\n    if (!params.url) {\n      return res.status(400).json([{signup: false, message: 'Домен не передан'}]);\n    }\n    if (!params.channels) {\n      return res.status(400).json([{signup: false, message: 'Каналы не переданы'}]);\n    }\n    const { url, channels } = params;\n\n    const userID = req.user.id;\n    const user = await User.findOne({id: userID});\n    const domain = new Domain({ url, id: uniqid(), channels})\n    user.domains.push(domain);\n    await user.save();\n\n    return res.json([{ flag: true, message: 'Домен успешно добавлен'}]);\n  }\n\n  controller.edit = async function(req, res) {\n    const params = req.body\n    if (!params.url) {\n      return res.status(400).json([{signup: false, message: 'Домен не передан'}]);\n    }\n    if (!params.id) {\n      return res.status(400).json([{signup: false, message: 'Id домена не передан'}]);\n    }\n    const { url, id } = params;\n\n    const userID = req.user.id;\n    const user = await User.findOne({id: userID});\n    user.domains.find((domain) => { return domain.id === id }).url = url;\n    await user.save();\n\n    return res.json([{ flag: true, message: 'Домен успешно изменен'}]);\n  }\n\n  controller.delete = async function(req, res) {\n\n    if (!req.params.id) {\n      return res.status(400).json([{signup: false, message: 'Id домена не передан'}]);\n    }\n    const { id } = req.params;\n\n    const userID = req.user.id;\n    const user = await User.findOne({id: userID});\n    user.domains = user.domains.filter((domain)=>{ return domain.id != id });\n    await user.save();\n\n    return res.json([{ flag: true, message: 'Домен успешно удален'}]);\n  }\n\n  controller.logs = async function(req, res) {\n    if (!req.params.domainId) {\n      return res.status(400).json([{signup: false, message: 'Id домена не передан'}]);\n    }\n    const { domainId } = req.params;\n    const userID = req.user.id;\n\n    const user = await User.findOne({id: userID});\n    if (!user) {\n      return res.status(400).json([{signup: false, message: 'Пользователь не найден'}]);\n    }\n    const domain = user.domains.find((domain) => (domain.id === domainId));\n    const { logs } = domain;\n\n    return res.json([{ flag: true, logs }]);\n  }\n\n  return controller\n}\n","import jwt from 'express-jwt'\nimport uniqid from 'uniqid';\n\n\nexport default (ctx) => {\n  const User = ctx.models.User;\n  const Channel = ctx.models.Channel;\n\n  let controller = {};\n\n  controller.getChannels = async function(req, res) {\n    const userID = req.user.id;\n    const user = await User.findOne({id: userID});\n\n    return res.json(user.channels);\n  }\n\n  controller.create = async function(req, res) {\n    const params = req.body;\n\n    if (!params.type) {\n      return res.status(400).json([{flag: false, message: 'type не передан'}]);\n    }\n    if (!params.endpoint) {\n      return res.status(400).json([{flag: false, message: 'endpoint не передан'}]);\n    }\n    const { type, endpoint } = params;\n\n    const userID = req.user.id;\n    const user = await User.findOne({id: userID});\n    const channel = new Channel({ id: uniqid(), type, endpoint })\n    user.channels.push(channel);\n    await user.save();\n\n    return res.json([{ flag: true, message: 'Channel успешно добавлен'}]);\n  }\n\n  controller.edit = async function(req, res) {\n    const params = req.body;\n\n    if (!params.type) {\n      return res.status(400).json([{flag: false, message: 'type не передан'}]);\n    }\n    if (!params.endpoint) {\n      return res.status(400).json([{flag: false, message: 'endpoint не передан'}]);\n    }\n    const { type, endpoint } = params;\n\n    const userID = req.user.id;\n    const user = await User.findOne({id: userID});\n    channel = user.channels.find((channel) => { return channel.id === id })\n    channel.type = type;\n    channel.endpoint = endpoint;\n    await user.save();\n\n    return res.json([{ flag: true, message: 'Канал успешно изменен'}]);\n  }\n\n  controller.delete = async function(req, res) {\n\n    if (!req.params.id) {\n      return res.status(400).json([{flag: false, message: 'Id канала не передан'}]);\n    }\n    const { id } = req.params;\n\n    const userID = req.user.id;\n    const user = await User.findOne({id: userID});\n    user.channels = user.channels.filter((channel)=>{ return channel.id != id });\n    await user.save();\n\n    return res.json([{ flag: true, message: 'Канал успешно удален'}]);\n  }\n\n\n\n  return controller\n}\n","import Auth from './Auth/Auth';\nimport Domain from './Domain/Domain';\nimport Channel from './Channel/Channel';\n\nexport default function () {\n  return {\n    Auth: Auth(...arguments),\n    Domain: Domain(...arguments),\n    Channel: Channel(...arguments),\n  }\n}\n","import nodemailer from 'nodemailer';\nimport smtpTransport from 'nodemailer-smtp-transport';\n\nexport default (ctx) => {\n  if (!ctx.log) throw '!log'\n\n  const transporter = nodemailer.createTransport(smtpTransport(ctx.config.nodemailer));\n\n  return  transporter;\n}\n","import Transporter from './Nodemailer/index';\n\nexport default function () {\n  return {\n    Transporter: Transporter(...arguments),\n  }\n}\n","import _ from 'lodash';\nimport { AsyncRouter } from 'express-async-router';\n\nexport default (ctx) => {\n  if (!_.has(ctx, 'controllers.Auth.signup')) throw '!controllers.Auth.signup'\n  if (!_.has(ctx, 'controllers.Auth.login')) throw '!controllers.Auth.login'\n  if (!_.has(ctx, 'controllers.Auth.validate')) throw '!controllers.Auth.validate'\n  if (!_.has(ctx, 'controllers.Auth.forgot')) throw '!controllers.Auth.forgot'\n  if (!_.has(ctx, 'controllers.Auth.checkForgotToken')) throw '!controllers.Auth.checkForgotToken'\n  if (!_.has(ctx, 'controllers.Auth.reset')) throw '!controllers.Auth.reset'\n\n\tconst api = AsyncRouter();\n\n  api.all('/validate', ctx.controllers.Auth.validate);\n  api.post('/signup', ctx.controllers.Auth.signup);\n  api.post('/login', ctx.controllers.Auth.login);\n  api.post('/forgot', ctx.controllers.Auth.forgot);\n  api.get('/forgot/:forgotEmailToken', ctx.controllers.Auth.checkForgotToken);\n  api.post('/reset', ctx.controllers.Auth.reset);\n\n\treturn api;\n}\n","import _ from 'lodash';\nimport mongoose from 'mongoose';\nimport { AsyncRouter } from 'express-async-router';\n\nexport default (ctx) => {\n  if (!_.has(ctx, 'controllers.Domain.domains')) throw '!controllers.Domain.domains'\n  if (!_.has(ctx, 'controllers.Domain.create')) throw '!controllers.Domain.create'\n  if (!_.has(ctx, 'controllers.Domain.delete')) throw '!controllers.Domain.delete'\n  if (!_.has(ctx, 'controllers.Domain.edit')) throw '!controllers.Domain.edit'\n  if (!_.has(ctx, 'controllers.Domain.logs')) throw '!controllers.Domain.logs'\n\n\tconst api = AsyncRouter();\n\n  api.get('/', ctx.controllers.Domain.domains);\n  api.post('/', ctx.controllers.Domain.create);\n  api.delete('/:id', ctx.controllers.Domain.delete);\n  api.put('/', ctx.controllers.Domain.edit);\n  api.get('/:domainId/logs', ctx.controllers.Domain.logs);\n\n\treturn api;\n}\n","import { AsyncRouter } from 'express-async-router';\nimport expressJwt from 'express-jwt';\nimport getAuth from './auth/auth';\nimport getDomain from './domain/domain';\n\n\nexport default (ctx) => {\n\tconst api = AsyncRouter();\n\n  api.all('/', () => ({ok: true, version: '1.0.1'}))\n\n  api.use('/auth', getAuth(ctx));\n\tapi.use('/domains', expressJwt({secret: ctx.config.jwt.secret}), getDomain(ctx));\n\n\tapi.use('/', (err, req, res, next) => {\n\t\treturn res.status(401).json([{ flag: false, message: 'Не авторизован' }])\n\t})\n\n\treturn api;\n}\n","import bunyan from 'bunyan';\nimport express from 'express';\nimport mongoose from 'mongoose';\n\nimport getMiddlewares from './middlewares/index';\nimport getModels from './models/index';\nimport getControllers from './controllers/index';\nimport getUtils from './utils/index';\nimport getApi from './api/api';\n\nexport default class App {\n  constructor(params = {}) {\n    Object.assign(this, params);\n    if (!this.log) this.log = this.getLogger();\n    this.init();\n  }\n\n  getLogger(params) {\n    return bunyan.createLogger(Object.assign({\n      name: 'app',\n      src: __DEV__,\n      level: 'trace',\n    }, params))\n  }\n\n  getMiddlewares() {\n    return getMiddlewares(this);\n  }\n\n  getModels() {\n    return getModels(this);\n  }\n\n  getDatabase() {\n    return {\n      run: () => {\n        new Promise((resolve) => {\n          mongoose.connect(this.config.db.url);\n          resolve();\n        });\n      }\n    }\n  }\n\n  getControllers() {\n    return getControllers(this);\n  }\n\n  getUtils() {\n    return getUtils(this);\n  }\n\n  init() {\n    this.log.trace('App init');\n    this.app = express();\n    this.db = this.getDatabase();\n\n    this.utils = this.getUtils();\n    this.log.trace('utils', Object.keys(this.utils));\n\n    this.middlewares = this.getMiddlewares();\n    this.log.trace('middlewares', Object.keys(this.middlewares));\n\n    this.models = this.getModels();\n    this.log.trace('models', Object.keys(this.models));\n\n    this.controllers = this.getControllers();\n    this.log.trace('controllers', Object.keys(this.controllers));\n\n    this.useMiddlewares();\n    this.useRoutes();\n    this.useDefaultRoute();\n  }\n\n  useMiddlewares() {\n    this.app.use(this.middlewares.catchError);\n    this.app.use(this.middlewares.reqLog);\n    this.app.use(this.middlewares.accessLogger);\n    this.app.use(this.middlewares.reqParser);\n\n    this.app.use(this.controllers.Auth.parseToken);\n    this.app.use(this.controllers.Auth.parseUser);\n  }\n  useRoutes() {\n    const api = getApi(this);\n    this.app.use('/api/v1', api);\n  }\n  useDefaultRoute() {\n    this.app.use((req, res, next) => {\n      const err = ('Route not found');\n      next(err);\n    });\n  }\n\n  async run() {\n    this.log.trace('App run');\n    try {\n      await this.db.run();\n    } catch (err) {\n      this.log.fatal(err);\n    }\n    return new Promise((resolve) => {\n      this.app.listen(this.config.port, () => {\n        this.log.info(`App \"${this.config.name}\" running on port ${this.config.port}!`);\n        resolve(this);\n      });\n    });\n  }\n}\n","import config from './config/index';\nimport App from './App';\n\nconst app = new App({ config });\napp.run();\n"],"names":["global","__DEV__","__PROD__","levelFn","data","err","status","duration","logStart","leftPad","method","url","reqId","logFinish","time","toFixed","length","params","req","res","next","log","child","ws","host","headers","baseUrl","referer","header","ip","connection","remoteAddress","socket","debug","body","trace","hrtime","process","logging","statusCode","getHeader","diff","on","ctx","bodyParser","json","urlencoded","extended","cookieParser","cors","error","query","stack","uuid","v4","requests","forEach","val","key","bind","responses","accessLogger","arguments","reqParser","catchError","reqLog","extendReqRes","bcryptGenSalt","Promise","promisify","bcrypt","genSalt","bcryptHash","hash","bcryptCompare","compare","schema","mongoose","Schema","String","statics","isValidEmail","email","re","test","generatePassword","Math","random","toString","substr","methods","toJSON","_","omit","toObject","getIdentity","object","pick","generateAuthToken","jwt","sign","config","secret","verifyPassword","password","SALT_WORK_FACTOR","pre","isModified","then","salt","catch","model","User","models","transporter","utils","Transporter","controller","validate","user","findOne","id","message","getUserFields","validationUserFields","userFields","valid","captcha","isValid","signup","getUserCriteria","criteria","existUser","uniqid","save","result","login","forgot","crypto","randomBytes","forgotEmailToken","token","siteUrl","mailText","sendMail","mailOptions","checkForgotToken","reset","checkPassword","getToken","authorization","split","cookies","devToken","parseToken","parseUser","options","_errJwt","isAuth","_id","send","Domain","domains","userID","create","channels","push","domain","flag","edit","find","delete","filter","logs","domainId","Channel","getChannels","type","endpoint","channel","Auth","nodemailer","createTransport","smtpTransport","has","api","AsyncRouter","all","controllers","post","get","put","ok","version","use","getAuth","expressJwt","getDomain","App","getLogger","init","bunyan","createLogger","getMiddlewares","getModels","resolve","connect","db","getControllers","getUtils","app","express","getDatabase","middlewares","useMiddlewares","useRoutes","useDefaultRoute","getApi","run","fatal","listen","port","info","name"],"mappings":"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"}